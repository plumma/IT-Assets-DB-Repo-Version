@model ITAssetsDatabase.Web.ViewModels.Assets.RegisterAssetViewModel

@{
    ViewBag.Title = "Create";
}

<style>


    /*     BASE PURPLE COLOUR     #6c254a;   http://www.color-hex.com/color/6c254a    */

        body {
        background-image: url('../../Images/Office.jpeg');
        min-height: 100%;
        background-repeat: no-repeat;
        background-attachment: fixed;
        background-position: center;
        background-size: cover;
    }

    #wrapper {
        background-color: white;
        box-shadow: 5px 5px 5px #888888;      
        width: 65%;
        margin: 60px auto 40px;
        /* Fixes child DIV FormHeader collapsing top margin */
        overflow:auto;
    }

   .FormHeader {

        font-size: 2em;
        font-weight:bold;
        color:white;    
        padding: 30px 30px;
        background-color: #6c254a;        
        height: 90px;
        text-align:center;
        vertical-align:central;
        
       
    }

    .FormSubjects {

        font-size: 1.2em;
        font-weight:bold;
        color:black;
        padding-top:30px;
        padding-bottom:30px;
        clear:both;float:left;
    }

   


    input:not([type]), input[type=text]:not(.browser-default), input[type=password]:not(.browser-default), input[type=email]:not(.browser-default), input[type=url]:not(.browser-default), input[type=time]:not(.browser-default), input[type=date]:not(.browser-default), input[type=datetime]:not(.browser-default), input[type=datetime-local]:not(.browser-default), input[type=tel]:not(.browser-default), input[type=number]:not(.browser-default), input[type=search]:not(.browser-default), textarea.materialize-textarea {

    background-color: #F1F1F1;
    border: thin;
    border-bottom: 1px solid #9e9e9e;
    border-radius: 2px;
    outline: none;
    height :30px;
    width: 450px;
    font-size: 1rem;
    margin: 0 0 20px 0;
    padding: 0;
    padding-left:50px;
    box-shadow: none;
    box-sizing: content-box;
    transition: all 0.3s;
    color: black;
    text-align: left;
    vertical-align:central;
}

    input:not([type]):focus:not([readonly]), input[type=text]:not(.browser-default):focus:not([readonly]), input[type=password]:not(.browser-default):focus:not([readonly]), input[type=email]:not(.browser-default):focus:not([readonly]), input[type=url]:not(.browser-default):focus:not([readonly]), input[type=time]:not(.browser-default):focus:not([readonly]), input[type=date]:not(.browser-default):focus:not([readonly]), input[type=datetime]:not(.browser-default):focus:not([readonly]), input[type=datetime-local]:not(.browser-default):focus:not([readonly]), input[type=tel]:not(.browser-default):focus:not([readonly]), input[type=number]:not(.browser-default):focus:not([readonly]), input[type=search]:not(.browser-default):focus:not([readonly]), textarea.materialize-textarea:focus:not([readonly]) {
    border-bottom: 1px solid #6c254a;  
    box-shadow: 0 1px 0 0 #6c254a;  

    }

    input:not([type]).valid, input:not([type]):focus.valid, input[type=text]:not(.browser-default).valid, input[type=text]:not(.browser-default):focus.valid, input[type=password]:not(.browser-default).valid, input[type=password]:not(.browser-default):focus.valid, input[type=email]:not(.browser-default).valid, input[type=email]:not(.browser-default):focus.valid, input[type=url]:not(.browser-default).valid, input[type=url]:not(.browser-default):focus.valid, input[type=time]:not(.browser-default).valid, input[type=time]:not(.browser-default):focus.valid, input[type=date]:not(.browser-default).valid, input[type=date]:not(.browser-default):focus.valid, input[type=datetime]:not(.browser-default).valid, input[type=datetime]:not(.browser-default):focus.valid, input[type=datetime-local]:not(.browser-default).valid, input[type=datetime-local]:not(.browser-default):focus.valid, input[type=tel]:not(.browser-default).valid, input[type=tel]:not(.browser-default):focus.valid, input[type=number]:not(.browser-default).valid, input[type=number]:not(.browser-default):focus.valid, input[type=search]:not(.browser-default).valid, input[type=search]:not(.browser-default):focus.valid, textarea.materialize-textarea.valid, textarea.materialize-textarea:focus.valid {
    border-bottom: 1px solid #c4a7b6;
    box-shadow: 0 1px 0 0 #c4a7b6;
}


    /* Materalize change colour of dropdown/input box. */

    
  /* label color */
   .input-field label {
     color: #6c254a;
   }
   /* label focus color */
   .input-field input[type=text]:focus + label {
     color: #6c254a;
   }
   /* label underline focus color */
   .input-field input[type=text]:focus {
     border-bottom: 1px solid #6c254a;
     box-shadow: 0 1px 0 0 #6c254a;;
   }
   /* valid color */
   .input-field input[type=text].valid {
     border-bottom: 1px solid #6c254a;
     box-shadow: 0 1px 0 0 #6c254a;
   }

   /* invalid color */
   .input-field input[type=text].invalid {
     border-bottom: 1px solid #6c254a;
     box-shadow: 0 1px 0 0 #6c254a;
   }
   /* icon prefix focus color */
   .input-field .prefix.active {
     color: #6c254a;
   }
        

   .dropdown-content li > a, .dropdown-content li > span {
    color: #6c254a !important;
}


    input:focus, select:focus { 
       
        -webkit-box-shadow: 0px 0px 0px 1px rgba(242,17,17,1);
        -moz-box-shadow: 0px 0px 0px 1px rgba(242,17,17,1);
        box-shadow: 0px 0px 0px 1px rgba(242,17,17,1);

        background-color: #f3eeee;
	    
    }


    select {

        height:33px;
        width:440px;
        background-color: #FFF7F7;      
        padding-left:27px;  
        display:normal;

    }
      


    #textBody {
        margin: 20px; /*border:medium solid;*/
        margin-top: 0px;
        padding:30px;
    }


    .Lookup {
        background: transparent url('../Images/icon_search_trans.png') 8px 8px no-repeat;
        background-color: #FFF7F7;       
    }

    .Helpdesk {
        background: transparent url('../Images/F.png') 8px 8px no-repeat;
    }

    #ResolutionText {
        margin-top: 10px;
        margin-bottom: 30px;
        width: 670px;
        word-wrap: break-word;
    }



    #CloseBtn {
        clear: both;
        padding-top: 80px;
        margin-left: 310px;
        /*float:right;*/
        position: relative;
    }

    .editor-label {
        clear: both;
        margin-top: 10px;
        float: left;
        vertical-align: central;
    }

    .editor-field {
        float: right;
        vertical-align: central;
        
    }




    h4 {
        margin-bottom: 40px;
    }

    p {
        clear: both;
    }


    textarea {
        
        height: 147px;
        border-radius: 0px;
        
    }


    #please-wait {
     
     display: none;
     position: fixed;
     left: 0px;
     top: 0px;
     width:100%;
     height:100%;
     text-align:center;
     z-index: 1000;
    }

        #please-wait .modal {
            z-index: 1999;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            opacity: 0.5;           
            background-color: black;
            margin-left: 0;
        }

        #please-wait .spinner {
            z-index: 2000;
            padding-top: 20px;
            padding-left: 20px;
            background: #ffffff url("../../Images/fetch.gif") no-repeat 15px center;
            width: 400px;
            height: 40px;
            border: 2px solid #666;
            font-weight: bold;
            text-align: center;
            position: relative;
            margin-left: auto;
            margin-right: auto;
            top: 35%;
            display: block;
            border-radius: 5px;        
            
        }


    #fetch  {
        color: black;
    }

    .button {

          border-radius: 0px;
          background-color: white;
    }
    

</style>



@using (Html.BeginForm())
{
    @Html.AntiForgeryToken()
    @Html.ValidationSummary(true)


 <div id="wrapper">

     <div class="FormHeader">- Add New Asset -</div>

            <div id="textBody">
                
                <div class="FormSubjects">Request Details</div>


                <div class="editor-label">
                    Helpdesk Ticket Reference
                </div>
                <div style="position:relative" class="editor-field">
                    <div style="display:inline;position:absolute;top:8px;right:20px">@Html.ValidationMessageFor(model => model.HelpdeskRef)</div>
                    @Html.EditorFor(model => model.HelpdeskRef, new { @class = "Helpdesk" })

                </div>


                <div class="editor-label">
                    Domain
                </div>
                <div style="padding-bottom:6px;" class="editor-field">
                    @Html.DropDownListFor(model => model.DomainId, Model.Domain)
                </div>



                <div class="editor-label">
                    Lookup Requester
                </div>
                <div style="position:relative" class="editor-field">
                    <div style="display:inline;position:absolute;top:8px;right:20px">@Html.ValidationMessageFor(m => m.LookupRequester)</div>
                    <div id="Requester_eggtimer" style="display:none;position:absolute;top:8px;right:20px"><img src="~/Images/ajax-loader.gif" /></div>

                    @Html.TextBoxFor(m => m.LookupRequester, new { placeholder = "Lookup Requester", @class = "Lookup" })
                    @Html.HiddenFor(model => model.RequesterSID)
                    @Html.HiddenFor(model => model.RequesterFirstName)
                    @Html.HiddenFor(model => model.RequesterMiddleName)
                    @Html.HiddenFor(model => model.RequesterSurname)
                    @Html.HiddenFor(model => model.RequesterEmail)
                    @Html.HiddenFor(model => model.RequesterDomain)
                    @Html.HiddenFor(model => model.RequesterDomainLogon)
                </div>


                <div class="editor-label">
                    Look up End User
                </div>
                <div style="position:relative" class="editor-field">
                    <div style="display:inline;position:absolute;top:8px;right:20px">@Html.ValidationMessageFor(m => m.LookupEndUser)</div>
                    <div id="EndUser_eggtimer" style="display:none;position:absolute;top:8px;right:20px"><img src="~/Images/ajax-loader.gif" /></div>

                    @Html.TextBoxFor(m => m.LookupEndUser, new { placeholder = "Lookup EndUser", @class = "Lookup" })
                    @Html.HiddenFor(model => model.AssigneeSID)
                    @Html.HiddenFor(model => model.AssigneeFirstName)
                    @Html.HiddenFor(model => model.AssigneeMiddleName)
                    @Html.HiddenFor(model => model.AssigneeSurname)
                    @Html.HiddenFor(model => model.AssigneeEmail)
                    @Html.HiddenFor(model => model.AssigneeDomain)
                    @Html.HiddenFor(model => model.AssigneeDomainLogon)
                </div>

                @*     Asset Details    *@

               <div class="FormSubjects">Asset Details</div>

                    <div class="editor-label">
                        Purchase Request Reference
                    </div>
                    <div style="position:relative" class="editor-field">
                        <div style="display:inline;position:absolute;top:8px;right:20px">
                            @Html.ValidationMessageFor(model => model.PRRef)
                        </div>
                        @Html.EditorFor(model => model.PRRef)

                    </div>


                    <div class="editor-label">
                        Purchase Order Reference
                    </div>
                    <div style="position:relative" class="editor-field">
                        <div style="display:inline;position:absolute;top:8px;right:20px">
                            @Html.ValidationMessageFor(model => model.PORef)
                        </div>
                        @Html.EditorFor(model => model.PORef)
                    </div>


                    <div class="editor-label">
                        Device Asset Number
                    </div>
                    <div style="position:relative" class="editor-field">
                        <div style="display:inline;position:absolute;top:8px;right:20px">
                            @Html.ValidationMessageFor(model => model.AssetNo)
                        </div>
                        @Html.EditorFor(model => model.AssetNo)

                    </div>

                    <div class="editor-label">
                        Device Serial Number
                    </div>
                    <div style="position:relative" class="editor-field">
                        <div style="display:inline;position:absolute;top:8px;right:20px">
                            @Html.ValidationMessageFor(model => model.SerialNo)
                        </div>
                        @Html.EditorFor(model => model.SerialNo)

                    </div>

                    <div class="editor-label">
                        MAC Address
                    </div>
                    <div style="position:relative" class="editor-field">
                        <div style="display:inline;position:absolute;top:8px;right:20px">
                            @Html.ValidationMessageFor(model => model.MAC_Address)
                        </div>
                        @Html.EditorFor(model => model.MAC_Address)
                    </div>


                    <div class="editor-label">
                        Location
                    </div>
                    <div style="position:relative" class="editor-field">
                        <div style="display:inline;position:absolute;top:8px;right:20px">@Html.ValidationMessageFor(m => m.LookupLocation)</div>
                        @Html.TextBoxFor(m => m.LookupLocation, new { placeholder = "Lookup Location", @class = "Lookup" })
                        @Html.HiddenFor(model => model.LocationId)

                    </div>

                    <div class="editor-label">
                        Lookup device model
                    </div>
                    <div style="position:relative" class="editor-field">
                        <div style="display:inline;position:absolute;top:8px;right:20px">@Html.ValidationMessageFor(m => m.LookupDeviceModel)</div>
                        @Html.TextBoxFor(m => m.LookupDeviceModel, new { placeholder = "Lookup Device Model", @class = "Lookup" })
                        @Html.HiddenFor(model => model.DeviceId)
                    </div>


                    @*     Build information      *@

                    <div class="FormSubjects">Build Information</div>

                    <div id="fetcherror" style="padding-top:60px;color:red;float:right;padding-right:70px;display:none">Please correct Highlighted fields before Fetch</div>
                
                    <div class="editor-label">
                        Lookup Build
                    </div>
                    <div style="position:relative" class="editor-field">
                        <div style="display:inline;position:absolute;top:8px;right:20px">@Html.ValidationMessageFor(m => m.LookupBuild)</div>
                        @Html.TextBoxFor(m => m.LookupBuild, new { placeholder = "Lookup Build", @class = "Lookup" })
                        @Html.HiddenFor(model => model.BuildId)
                        @Html.HiddenFor(model => model.BuildDomain)
                    </div>

                    <div class="editor-label">
                        Add Hostname
                    </div>

                    <div style="position:relative" class="editor-field">
                        <a href="#" class="fetch" style="text-align:right" id="fetch">Fetch</a>

                        <div style="display:inline;position:absolute;top:8px;right:20px">@Html.ValidationMessageFor(m => m.Hostname)</div>
                        <div id="Fetch_eggtimer" style="display:none;position:absolute;top:8px;right:20px"><img src="~/Images/ajax-loader.gif" /></div>
                        @Html.TextBoxFor(m => m.Hostname, new { @readonly = true })
                        @Html.HiddenFor(model => model.HostnameId)
                    </div>

                    <div style="clear:both;padding-top:20px;padding-bottom:10px">
                        Notes
                    </div>
                    <div>
                        @Html.TextAreaFor(model => model.Notes)
                        @Html.ValidationMessageFor(model => model.Notes)
                    </div>

                    <p style="text-align:center">
                        <input class="button" style="clear:both" type="submit" value="ADD ASSET" id="register" />
                    </p>

                    @Html.HiddenFor(model => model.StaffId)

                </div>
        </div>

}

<p class="BackPage">
    <i class="fa fa-long-arrow-left" aria-hidden="true"></i> @Html.ActionLink("Back to Assets", "Index")
</p>



<div id="please-wait">
    <div class="modal">
        <div class="spinner">Doing Ping and AD check Pls Wait </div>
    </div>
</div>




@section Scripts {

    @Scripts.Render("~/bundles/jqueryval")
    @Scripts.Render("~/bundles/jqueryui")
    @Styles.Render("~/Content/themes/base/css")   @* Allows Background to go grey in Modal*@
    <link href="~/Content/themes/base/jquery.ui.autocomplete.css" rel="stylesheet" />
    <script src="~/Scripts/Autosize/jquery.autosize.min.js"></script>
    <script src="~/Scripts/Autosize/jquery.autosize.js"></script>
    <script src="~/Scripts/plupload-2.1.2/js/plupload.full.min.js"></script>



    <script>

        $(document).ready(function () {
    


          //  Initialization for dropdowns is only necessary if you create them dynamically, uncomment below if needed.

            //$('select').material_select();



            // LookupRequester AD

            //$('#LookupRequester').autocomplete({

            //    source: function (request, response) {
            //        //var filter = $("#DomainId").val();
            //        var filter = 1;

            //        $.getJSON("/Assets/LookupPersonAutocomplete", { term: request.term, DomainId: filter }, response);
            //    },

            //    select: function (event, ui) {
            //        event.preventDefault();  // Stops the default action of displaying the Value rather than the label in the box after selection
            //        $("#LookupRequester").val(ui.item.label);  // Displays Label in box after selection
            //        $("#RequesterSID").val(ui.item.value);

            //        $("#RequesterFirstName").val(ui.item.FirstName);
            //        $("#RequesterMiddleName").val(ui.item.MiddleName);
            //        $("#RequesterSurname").val(ui.item.Surname);
            //        $("#RequesterEmail").val(ui.item.Email);
            //        $("#RequesterDomain").val(ui.item.Domain);
            //        $("#RequesterDomainLogon").val(ui.item.Logon);
            //    },
            //    focus: function (event, ui) {
            //        event.preventDefault();
            //        //$("#customer-search").val(ui.item.label);
            //    }

            //});

            //  LookupRequester from LDAP

            $('#LookupRequester').autocomplete({              

                source: function (request, response) {           

                    $("#Requester_eggtimer").css('display', 'inline');

                    //var filter = $("#DomainId").val();
                    var filter = 1;

                    $.getJSON("/Assets/LookupPersonAutocomplete", { term: request.term, DomainId: filter },
                        response).then(function () {
                            $("#Requester_eggtimer").css('display', 'none')
                        });

                },

                select: function (event, ui) {

                    event.preventDefault();  // Stops the default action of displaying the Value rather than the label in the box after selection
                    $("#LookupRequester").val(ui.item.label);  // Displays Label in box after selection
                    $("#RequesterSID").val(ui.item.value);

                    $("#RequesterFirstName").val(ui.item.FirstName);
                    $("#RequesterMiddleName").val(ui.item.MiddleName);
                    $("#RequesterSurname").val(ui.item.Surname);
                    $("#RequesterEmail").val(ui.item.Email);
                    $("#RequesterDomain").val(ui.item.Domain);
                    $("#RequesterDomainLogon").val(ui.item.Logon);
                },
                focus: function (event, ui) {
                    event.preventDefault();
                    //$("#customer-search").val(ui.item.label);
                }

            });

            $('#LookupEndUser').autocomplete({

                source: function (request, response) {

                    $("#EndUser_eggtimer").css('display', 'inline');

                    //var filter = $("#DomainId").val();
                    var filter = 1;
                    $.getJSON("/Assets/LookupPersonAutocomplete", { term: request.term, DomainId: filter }, response).then(function () {
                        $("#EndUser_eggtimer").css('display', 'none')
                    });

                },

                select: function (event, ui) {
                    event.preventDefault();  // Stops the deafult action of displaying the Value rather than the label in the box after selection
                    $("#LookupEndUser").val(ui.item.label);  // Displays Label in box after selection
                    $("#AssigneeSID").val(ui.item.value);

                    $("#AssigneeFirstName").val(ui.item.FirstName);
                    $("#AssigneeMiddleName").val(ui.item.MiddleName);
                    $("#AssigneeSurname").val(ui.item.Surname);
                    $("#AssigneeEmail").val(ui.item.Email);
                    $("#AssigneeDomain").val(ui.item.Domain);
                    $("#AssigneeDomainLogon").val(ui.item.Logon);

                },
                focus: function (event, ui) {
                    event.preventDefault();
                    //$("#customer-search").val(ui.item.label);
                }

            });


            //  LookupLocation

            $('#LookupLocation').autocomplete({
                source: '/Assets/LookupLocationAutocomplete',
                //delay: 500,
                //minLength: 2,

                select: function (event, ui) {
                    event.preventDefault();  // Stops the deafult action of displaying the Value rather than the label in the box after selection
                    $("#LookupLocation").val(ui.item.label);  // Displays Label in box after selection
                    $("#LocationId").val(ui.item.value);
                },
                focus: function (event, ui) {
                    event.preventDefault();
                    //$("#customer-search").val(ui.item.label);
                }

            });


            //  Lookup Device Model

            $('#LookupDeviceModel').autocomplete({
                source: '/Assets/LookupDeviceModelAutocomplete',
                //delay: 500,
                //minLength: 2,

                select: function (event, ui) {
                    event.preventDefault();  // Stops the default action of displaying the Value rather than the label in the box after selection
                    $("#LookupDeviceModel").val(ui.item.label);  // Displays Label in box after selection
                    $("#DeviceId").val(ui.item.value);
                },
                focus: function (event, ui) {
                    event.preventDefault();
                    //$("#customer-search").val(ui.item.label);
                }

            });


            //  Lookup Build


            $('#LookupBuild').autocomplete({

                source: function (request, response) {
                    var filter = $("#DeviceId").val();
                    $.getJSON("/Assets/LookupBuildAutocomplete", { term: request.term, filter: filter }, response);
                },


                select: function (event, ui) {
                    event.preventDefault();  // Stops the default action of displaying the Value rather than the label in the box after selection
                    $("#LookupBuild").val(ui.item.label);  // Displays Label in box after selection
                    $("#BuildId").val(ui.item.value);
                    $("#BuildDomain").val(ui.item.build_domain);
                },
                focus: function (event, ui) {
                    event.preventDefault();
                }

            });



            //Start of Fetch  //

            $('#fetch').click(function () {


                //     Check Location, Device, Build fields are filled in

                var isValid = true;

                $('#LookupLocation,#LookupDeviceModel,#LookupBuild,#LocationId,#DeviceId,#BuildId').each(function () {

                    if ($.trim($(this).val()) == "" || $(this).val() == 0) {

                        $(this).css({
                            "border": "1px solid red",
                            "background": "#FFCECE"
                        });

                        $("#fetcherror").css("display", "block");
                        isValid = false;
                    }

                    else {
                        $(this).css({
                            "border": "",
                            "background": ""
                        });

                    }

                    if (isValid == true) $("#fetcherror").css("display", "none");

                });

                if (isValid == true) {

                    $("#Fetch_eggtimer").css('display', 'inline');

                    var LocationId = $('#LocationId').val();
                    var DeviceId = $('#DeviceId').val();
                    var StaffId = $('#StaffId').val();
                    var BuildId = $('#BuildId').val();

                    $.ajax({
                        url: "/Assets/FetchHostname",
                        data: { LocationId: LocationId, DeviceId: DeviceId, StaffId: StaffId, BuildId: BuildId },
                        type: "GET"
                    }).done(function (mydata) {

                        $("#Fetch_eggtimer").css('display', 'none')

                        $('#please-wait').css('display', 'none');
                        $('#HostnameId').val(mydata.Id);
                        $('#Hostname').val(mydata.FullHostname);
                        $('#Hostname').focus();
                    });
                }
            });



            // End of Fetch  //



            // MAC Address Autocharacters

            $("#MAC_Address").live("keyup", function (event) {
                var limitField = $(this).val().trim().length;
                var limit = "17"
                if (event.keyCode != 8) {
                    if (limitField == 2) {
                        var fax_value = $(this).val().trim().concat(':');
                        $("#MAC_Address").val(fax_value);
                    } else if (limitField == 5) {
                        var fax_value = $(this).val().trim().concat(':');
                        $("#MAC_Address").val(fax_value);
                    } else if (limitField == 8) {
                        var fax_value = $(this).val().trim().concat(':');
                        $("#MAC_Address").val(fax_value);
                    } else if (limitField == 11) {
                        var fax_value = $(this).val().trim().concat(':');
                        $("#MAC_Address").val(fax_value);
                    }
                    else if (limitField == 14) {
                        var fax_value = $(this).val().trim().concat(':');
                        $("#MAC_Address").val(fax_value);
                    }
                }
                if (limitField > limit) {
                    $("#MAC_Address").val($(this).val().trim().substring(0, limit));
                }
            });



            // Register Asset

            $('#register').click(function () {

                $("#thisForm").submit();

            });


            $('select').material_select();



        })
    </script>

}
